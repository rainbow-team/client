<div nz-col *ngIf="!isProvinceMap">
  <div id="mapChina" style="width:100%;height:600px"></div>
</div>
<div *ngIf="isProvinceMap">
  <div nz-col [nzSpan]="24">
    <div id="mapProvince" style="width:100%;height:600px"></div>
    <div class="ret">
      <button nz-button nzType="primary" (click)="LoadChinaMap()">
        返回全国地图
      </button>
    </div>
    <div class="act">
      <nz-radio-group [(ngModel)]="actionType" [nzButtonStyle]="'solid'">
        <label nz-radio-button nzValue="view">查看</label>
        <label nz-radio-button nzValue="mark">标记</label>
        <label nz-radio-button nzValue="edit">编辑热区</label>
      </nz-radio-group>
    </div>
  </div>

  <nz-modal
    [(nzVisible)]="isEditorVisible"
    nzTitle="编辑单位平面图的热区信息"
    (nzOnCancel)="editorCancel()"
    (nzOnOk)="editorOk()"
    [nzOkLoading]="isEditorLoading"
    nzWidth="800"
  >
    <!-- <button nz-button (click)="addRow()" nzType="primary">添加热点</button> -->
    <nz-table #editRowTable nzBordered [nzData]="listOfData">
      <thead>
        <tr>
          <th>设施/矿山</th>
          <th nzWidth="30%">对应热区坐标</th>
          <th>模拟展示链接</th>
          <!-- <th nzWidth="120px">操作</th> -->
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of editRowTable.data">
          <td>
            <nz-select
              [(ngModel)]="editCache[data.id].data.subjectId"
              class="w200"
            >
              <nz-option
                *ngFor="let option of unit_subjects"
                [nzLabel]="option.name"
                [nzValue]="option.id"
              >
              </nz-option>
            </nz-select>
          </td>
          <td>
            <input
              type="text"
              nz-input
              [(ngModel)]="editCache[data.id].data.hotRegion"
            />
            <!-- <ng-container *ngIf="!editCache[data.id].edit; else regionInputTpl">
              {{ data.hotRegion }}
            </ng-container>
            <ng-template #regionInputTpl>
              <input
                type="text"
                nz-input
                [(ngModel)]="editCache[data.id].data.hotRegion"
              />
            </ng-template> -->
          </td>
          <td>
            <input
              type="text"
              nz-input
              [(ngModel)]="editCache[data.id].data.previewUrl"
            />
            <!-- <ng-container
              *ngIf="!editCache[data.id].edit; else previewUrlInputTpl"
            >
              {{ data.previewUrl }}
            </ng-container>
            <ng-template #previewUrlInputTpl>
              <input
                type="text"
                nz-input
                [(ngModel)]="editCache[data.id].data.previewUrl"
              />
            </ng-template> -->
          </td>
          <!-- <td>
            <div class="editable-row-operations">
              <ng-container *ngIf="!editCache[data.id].edit; else saveTpl">
                <a (click)="startEdit(data.id)">编辑</a>
              </ng-container>
              <ng-template #saveTpl>
                <a (click)="saveEdit(data.id)">保存</a>
                <a
                  nz-popconfirm
                  nzTitle="确认取消?"
                  (nzOnConfirm)="cancelEdit(data.id)"
                  >取消</a
                >
              </ng-template>
            </div>
          </td> -->
        </tr>
      </tbody>
    </nz-table>
  </nz-modal>

  <nz-modal
    [(nzVisible)]="isViewerVisible"
    nzTitle="营运单位详情"
    (nzOnCancel)="viewerCancel()"
    (nzOnOk)="viewerOk()"
    [nzOkLoading]="isViewerLoading"
    nzCancelDisabled="true"
    nzWidth="960"
  >
    <div style="height: 460px;">
      <div nz-col [nzSpan]="14" style="height:460px;overflow:scroll;">
        <img src="{{ unitImageUrl }}" usemap="#myMap" />
        <map name="myMap" id="myMap">
          <area
            *ngFor="let item of unit_regions"
            shape="polygon"
            coords="{{ item.hotRegion }}"
            href="{{ item.previewUrl }}"
            target="_blank"
            nz-popover
            nzPlacement="bottomRight"
            nzTitle="{{ subjectTitle }}"
            [(nzVisible)]="isSubjectVisible"
            nzTrigger="click"
            (click)="showSubjectDetail(item)"
            [nzContent]="contentTemplate"
          />
          <ng-template #contentTemplate>
            <div *ngIf="markerType === '0'" style="width: 400px">
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  设施名称：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{ selectedSubject.name }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  营运单位：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{
                    selectedSubject.serviceDepart
                  }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  建造年代：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{ selectedSubject.buildYear }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  监管类别：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{
                    selectedSubject.supervisionCategoryValue
                  }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  设施状态：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{
                    selectedSubject.statusValue
                  }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  审评状态：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{
                    selectedSubject.reviewStatusValue
                  }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  许可情况：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{
                    selectedSubject.permitSituationValue
                  }}</span>
                </div>
              </div>
              <div nz-row>
                <a
                  nz-button
                  style="margin-left:65px"
                  nzType="primary"
                  this.isSubjectVisible="true;"
                  target="_blank"
                  href="{{ selectedRegion.previewUrl }}"
                  >三维动态展示</a
                >
                <a
                  style="margin-left: 50px"
                  nz-button
                  nzType="primary"
                  target="_blank"
                  href="/#/searchShow/integratedAuery/facSearch?id={{
                    selectedSubject.id
                  }}"
                  >详细信息</a
                >
                <!-- <a nz-button nzType="primary">核安全审评信息</a>
                <a nz-button nzType="primary">核安全监督信息</a>
                <a nz-button nzType="primary">安全问题和事故事件</a> -->
              </div>
            </div>
            <div *ngIf="markerType === '1'" style="width: 400px">
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  铀矿山名称：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{ selectedSubject.name }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  营运单位：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{ selectedSubject.umineName }}</span>
                </div>
              </div>
              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  建造年代：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{ selectedSubject.buildYear }}</span>
                </div>
              </div>

              <div nz-row>
                <div nz-col [nzSpan]="8" class="ta_r">
                  设施状态：
                </div>
                <div nz-col [nzSpan]="16" class="ta_l">
                  <span class="showText">{{
                    selectedSubject.statusValue
                  }}</span>
                </div>
              </div>

              <div nz-row>
                <a
                  nz-button
                  style="margin-left:65px"
                  nzType="primary"
                  this.isSubjectVisible="true;"
                  target="_blank"
                  href="{{ selectedRegion.previewUrl }}"
                  >三维动态展示</a
                >
                <a
                  style="margin-left: 50px"
                  nz-button
                  nzType="primary"
                  target="_blank"
                  href="/#/searchShow/integratedAuery/uminmountainSearch?id={{
                    selectedSubject.id
                  }}"
                  >详细信息</a
                >
                <!-- <a nz-button nzType="primary">核安全审评信息</a>
                  <a nz-button nzType="primary">核安全监督信息</a>
                  <a nz-button nzType="primary">安全问题和事故事件</a> -->
              </div>
            </div>
          </ng-template>
        </map>
      </div>
      <div nz-col [nzSpan]="10">
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            单位名称：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.name }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            所属集团：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.groupName }}</span>
          </div>
        </div>

        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            基本概况：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.survey }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            厂址特征：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.feature }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            单位代号：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.code }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            法人代表：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.owner }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            地址：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.address }}</span>
          </div>
        </div>

        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            应急电话：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.emergencyTel }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            传真：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.fax }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            主管安全领导：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.leader }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            主管安全领导电话：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.leaderTel }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            安全部门领导：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.departLeader }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            安全部门领导电话：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.departLeaderTel }}</span>
          </div>
        </div>
        <div nz-row>
          <div nz-col [nzSpan]="8" class="ta_r">
            备注：
          </div>
          <div nz-col [nzSpan]="16" class="ta_l">
            <span class="showText">{{ selectedUnit.note }}</span>
          </div>
        </div>
      </div>
    </div>
  </nz-modal>

  <nz-modal
    [(nzVisible)]="isMarkerVisible"
    nzTitle="地图上添加单位标记"
    (nzOnCancel)="markerCancel()"
    (nzOnOk)="markerOk()"
    [nzOkLoading]="isMarkerLoading"
    nzWidth="400px"
  >
    <div style="height: 400px">
      <div nz-row style="height: 50px;">
        <div class="ta_l">
          <span class="clo_r">*</span>单位类型：
          <nz-radio-group [(ngModel)]="unitType">
            <label nz-radio nzValue="unit_service">核设施营运单位</label>
            <label nz-radio nzValue="unit_umine">铀矿冶单位</label>
          </nz-radio-group>
        </div>
      </div>
      <div
        nz-row
        class="ma_b20"
        *ngIf="unitType === 'unit_service'"
        style="height: 50px;"
      >
        <div class="ta_l">
          <span class="clo_r">*</span>请选择核设施营运单位：
          <nz-select
            style="width:calc(100% - 200px)"
            [(ngModel)]="unitId"
            [disabled]="isDisable"
            class="w200"
          >
            <nz-option
              *ngFor="let option of unit_services"
              [nzLabel]="option.name"
              [nzValue]="option.id"
            >
            </nz-option>
          </nz-select>
        </div>
      </div>
      <div
        nz-row
        class="ma_b20"
        *ngIf="unitType === 'unit_umine'"
        style="height: 50px;"
      >
        <div class="ta_l">
          <span class="clo_r">*</span>请选择铀矿冶单位：
          <nz-select
            style="width:calc(100% - 200px)"
            [(ngModel)]="unitId"
            [disabled]="isDisable"
            class="w200"
          >
            <nz-option
              *ngFor="let option of unit_umines"
              [nzLabel]="option.name"
              [nzValue]="option.id"
            >
            </nz-option>
          </nz-select>
        </div>
      </div>
      <!-- <button nz-button (click)="addRow()" nzType="primary">添加热区</button> -->
      <app-attachment
        [fileList]="fileList"
        [refid]="marker.id"
      ></app-attachment>

      <!-- <div class="clearfix">
        <nz-upload
          nzAction="uploadUrl"
          nzListType="picture-card"
          [(nzFileList)]="fileList"
          [nzShowButton]="fileList.length < 1"
          [nzShowUploadList]="showUploadList"
          [nzPreview]="handlePreview"
        >
          <i nz-icon nzType="plus"></i>
          <div class="ant-upload-text">上传平面图</div>
        </nz-upload>
        <nz-modal
          [nzVisible]="previewVisible"
          [nzContent]="modalContent"
          [nzFooter]="null"
          (nzOnCancel)="previewVisible = false"
        >
          <ng-template #modalContent>
            <img [src]="previewImage" [ngStyle]="{ width: '100%' }" />
          </ng-template>
        </nz-modal>
      </div> -->
    </div>
  </nz-modal>
</div>
