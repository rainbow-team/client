<div style="height: 100%;background:#fff">
  <div class="div_top">
    培训信息
  </div>

  <div style="    padding: 0 30px;">
    <div nz-row style="height: 50px" [nzType]="'flex'" [nzAlign]="'middle'">
      <div nz-col [nzSpan]="8">
        <nz-input-group [nzSuffix]="suffixIconSearch1" style="width: 300px;">
          <input type="text" nz-input placeholder="请输入班次搜索" [(ngModel)]="batchSearch">
        </nz-input-group>
        <ng-template #suffixIconSearch1>
          <i nz-icon type="search" (click)="search()"></i>
        </ng-template>
      </div>
      <div nz-col [nzSpan]="16" style="text-align: right;">

        <div class="fr">
          <button nz-button nzType="danger" class="delbtn" nz-popconfirm nzTitle="确定删除吗?" (nzOnConfirm)="delete()">删除</button>
        </div>

        <div class="fr">
          <button nz-button nzType="primary" style=" margin-right: 10px;" class="addbtn" (click)="add()">添加</button>
        </div>

      </div>
    </div>
    <div nz-row>
      <nz-table #nestedTable [nzData]="dataSet" class="commontable" [nzFrontPagination]="false" [nzTotal]="totalCount" [nzPageIndex]="pageIndex"
        nzShowSizeChanger [nzPageSize]="pageSize" (nzPageIndexChange)="pageIndexChange($event)" class="tablescoll_rainbow">
        <thead>
          <tr>
            <th nzShowCheckbox [(nzChecked)]="allChecked" [nzIndeterminate]="indeterminate" (nzCheckedChange)="checkAll($event)"></th>
            <th>序号</th>
            <th>培训班次</th>
            <th>培训开始时间</th>
            <th>培训结束时间</th>
            <th>成绩</th>
            <th>监督员证号</th>
            <th>发证日期</th>
            <th>到期时间</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of nestedTable.data;index as index ">
            <td nzShowCheckbox [(nzChecked)]="data.checked" (nzCheckedChange)="refreshStatus()"></td>
            <td>{{(pageIndex-1)*pageSize+1+index}}</td>
            <td>{{data.trainClass}}</td>
            <td>{{data.trainStartDate|recordtime}}</td>
            <td>{{data.trainEndDate|recordtime}}</td>
            <td>{{data.score}}</td>
            <td>{{data.number}}</td>
            <td>{{data.issueDate|recordtime}}</td>
            <td>{{data.expireDate|recordtime}}</td>
            <td>
              <a (click)="show(data,true);">查看</a>
              <nz-divider nzType="vertical"></nz-divider>
              <a (click)="show(data,false);">编辑</a>
            </td>
          </tr>
        </tbody>
      </nz-table>

    </div>
  </div>

  <div nz-row [nzType]="'flex'" [nzAlign]="'middle'" class="div_bottom" [nzJustify]="'end'">
    <button nz-button nzType="default" (click)="close()">关闭</button>
  </div>

  <nz-modal [(nzVisible)]="isVisible" [nzTitle]="modalTitle" [nzOkText]="okText" nzCancelText="取消" (nzOnOk)="SubmitTrainRecord();"
    (nzOnCancel)="isVisible=false;" nzWidth="700" [nzOkLoading]="isSaving">

    <div style="padding: 10px 30px 50px 0;">
      <div nz-row class="ma_b20">
        <div nz-col [nzSpan]="12" class="ta_r">
          培训班次：
          <input nz-input name="batch" [(ngModel)]="batch" style="width: 140px;" disabled/>
          <button nz-button nzType="primary" style=" margin-left: 10px;width: 50px;padding-left: 10px;" (click)="Associate()" [disabled]="isDisable">选择</button>
        </div>
      </div>
      <div nz-row class="ma_b20">
        <div nz-col [nzSpan]="12" class="ta_r">
          培训开始时间：
          <nz-date-picker name="beginDate" [(ngModel)]="beginDate" class="w200" [disabled]="true">
          </nz-date-picker>
        </div>
        <div nz-col [nzSpan]="12" class="ta_r">
          培训结束时间：
          <nz-date-picker name="endDate" [(ngModel)]="endDate" class="w200" [disabled]="true">
          </nz-date-picker>
        </div>
      </div>
      <div nz-row class="ma_b20">
        <div nz-col [nzSpan]="12" class="ta_r">
          成绩：
          <input nz-input name="score" [(ngModel)]="data.score" class="w200" [disabled]="isDisable" />
        </div>
        <div nz-col [nzSpan]="12" class="ta_r">
          监督员证号：
          <input nz-input name="number" [(ngModel)]="data.number" class="w200" [disabled]="isDisable" />
        </div>
      </div>
      <div nz-row>
        <div nz-col [nzSpan]="12" class="ta_r">
          到期时间：
          <nz-date-picker name="issueDate" [(ngModel)]="data.issueDate" class="w200" (ngModelChange)="changeIssueDate($event)" [disabled]="isDisable">
          </nz-date-picker>
        </div>
        <div nz-col [nzSpan]="12" class="ta_r">
          发证时间：
          <nz-date-picker name="expireDate" [(ngModel)]="data.expireDate" class="w200" [disabled]="true">
          </nz-date-picker>
        </div>
      </div>
    </div>
  </nz-modal>


  <nz-modal [(nzVisible)]="isAssociateVisible" nzTitle="关联培训信息" nzOkText="确定" nzCancelText="取消" (nzOnOk)="ConfirmAssociate()"
    (nzOnCancel)="isAssociateVisible=false;" nzWidth="900">

    <div style="position:relative;min-height:300px;">
      <div nz-row style="height: 50px" [nzType]="'flex'" [nzAlign]="'middle'">
        <div nz-col [nzSpan]="8">
          <nz-input-group [nzSuffix]="suffixIconSearch" style="width: 300px;">
            <input type="text" nz-input placeholder="请输入班次搜索" [(ngModel)]="batchAssociate">
          </nz-input-group>
          <ng-template #suffixIconSearch>
            <i nz-icon type="search" (click)="selectMonitorList()"></i>
          </ng-template>
        </div>
      </div>
      <div nz-row>
        <nz-table #nestedTableAssociate [nzData]="MonitorList" class="commontable" [nzFrontPagination]="false" [nzScroll]="{ y: '240px' }"
          [nzTotal]="totalCountAssociate" [nzPageIndex]="pageIndexAssociate" nzShowSizeChanger [nzPageSize]="pageSizeAssociate"
          (nzPageIndexChange)="pageIndexAssociateChange($event)">
          <thead>
            <tr>
              <th nzWidth="67px">序号</th>
              <th nzWidth="98px">培训班次</th>
              <th nzWidth="129px">培训开始日期</th>
              <th nzWidth="130px">培训结束日期</th>
              <th nzWidth="98px">培训地点</th>
              <th nzWidth="99px">参培人数</th>
              <th nzWidth="146px">培训内容及讲师</th>
              <th nzWidth="68px">备注</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of nestedTableAssociate.data;index as index" (click)="clickAssociateItem(data)" [ngClass]="{true:'table_select',false:''}[selectAssociateItem.id==data.id]">
              <td>{{(pageIndexAssociate-1)*pageSizeAssociate+1+index}}</td>
              <td>{{data.batch}}</td>
              <td>{{data.beginDate|recordtime}}</td>
              <td>{{data.endDate|recordtime}}</td>
              <td>{{data.place}}</td>
              <td>{{data.number}}</td>
              <td>{{data.content}}</td>
              <td>{{data.note}}</td>
            </tr>
          </tbody>
        </nz-table>
      </div>

    </div>


  </nz-modal>

</div>